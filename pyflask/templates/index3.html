<!DOCTYPE html>
<html>

<head>
    <title>Book API</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-5">Book API</h1>

        <h2>Books</h2>
        <ul id="book-list"></ul>

        <h2>Add Book</h2>
        <form id="add-book-form">
            <div class="mb-3">
                <label for="title" class="form-label">Title:</label>
                <input type="text" name="title" id="title" class="form-control" required>
            </div>

            <div class="mb-3">
                <label for="author" class="form-label">Author:</label>
                <input type="text" name="author" id="author" class="form-control" required>
            </div>

            <div class="mb-3">
                <label for="year" class="form-label">Year:</label>
                <input type="number" name="year" id="year" class="form-control" required>
            </div>

            <button id="btn_request" type="submit" class="btn btn-primary">Add Book</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@0.24.0/dist/axios.min.js"></script>
    <script>

        // document.querySelector('button#btn_request').addEventListener('click', function (event) {
        //     const result = document.querySelector('#result');
        //     const result_address = document.querySelector('#result_address');

        // })

        // const form = document.getElementById('add-book-form');
        // form.addEventListener('submit', (event) => {
        //     event.preventDefault();
        //     const formData = new FormData(form);
        //     fetch('/books', {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({
        //             book: formData.get('title'),
        //             author: formData.get('author'),
        //             published_year: formData.get('published_year')
        //         })
        //     })
        //     form.reset();
        // });


        const bookList = document.querySelector('#book-list');
        const addBookForm = document.querySelector('#add-book-form');

        function loadBooks() {
            fetch.get('/books', {
                method: 'GET'
            })
                .then(response => {
                    bookList.innerHTML = '';
                    response.data.forEach(book => {
                        const li = document.createElement('li');
                        li.textContent = `${book[1]} by ${book[2]}, published in ${book[3]}`;
                        bookList.appendChild(li);
                    });
                });
        }

        function addBook(event) {
            event.preventDefault();
            const title = document.querySelector('#title').value;
            const author = document.querySelector('#author').value;
            const year = document.querySelector('#year').value;

            fetch('/books', {
                method: 'POST',
                body: JSON.stringify({
                    title: title,
                    author: author,
                    published_year: year
                })
            })
                .then(response => {
                    console.log(response.data);
                    loadBooks();
                });
        }

        loadBooks();
        addBookForm.addEventListener('submit', addBook);
    </script>
</body>

</html>