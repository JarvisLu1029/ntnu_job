<!DOCTYPE html>
<html>
<head>
	<title>Add Book</title>
	<style>
		input {
			margin: 5px;
		}
		button {
			margin: 5px;
		}
		table {
			border-collapse: collapse;
		}
		td, th {
			border: 1px solid black;
			padding: 5px;
		}
	</style>
</head>
<body>
	<h1>Add Book</h1>
	<form id="add-book-form">
		<input type="text" name="book" placeholder="Book" required>
		<input type="text" name="author" placeholder="Author" required>
		<input type="number" name="published_year" placeholder="Published Year" required>
		<button type="submit">Add Book</button>
	</form>
	<h1>Books</h1>
	<table id="book-table">
		<thead>
			<tr>
				<th>ID</th>
				<th>書名</th>
				<th>作者</th>
				<th>出版年</th>
				<th>Action</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<script>
		const form = document.getElementById('add-book-form');
		form.addEventListener('submit', (event) => {
			event.preventDefault();
			const formData = new FormData(form);
			fetch('/books', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					book: formData.get('book'),
					author: formData.get('author'),
					published_year: formData.get('published_year')
				})
			})
			.then(response => response.json())
			.then(data => {
				const book = data.book;
				const row = document.createElement('tr');
				row.innerHTML = `
					<td>${book.id}</td>
					<td>${book.book}</td>
					<td>${book.author}</td>
					<td>${book.published_year}</td>
					<td>
						<button data-id="${book.id}" class="delete-btn">Delete</button>
					</td>
				`;
				const tbody = document.querySelector('#book-table tbody');
				tbody.appendChild(row);
				form.reset();
			});
		});

		document.addEventListener('click', (event) => {
			if (event.target.classList.contains('delete-btn')) {
				const bookId = event.target.dataset.id;
				fetch(`/books/${bookId}`, {
					method: 'DELETE'
				})
				.then(response => response.json())
				.then(data => {
					event.target.closest('tr').remove();
				});
			}
		});

		fetch('/books')
		.then(response => response.json())
		.then(data => {
			const books = data.books;
			const tbody = document.querySelector('#book-table tbody');
			for (const book of books) {
				const row = document.createElement('tr');
				row.innerHTML = `
					<td>${book.id}</td>
					<td>${book.book}</td>
					<td>${book.author}</td>
					<td>${book.published_year}</td>
					<td>
						<button data-id="${book.id}" class="delete-btn">Delete</button>
					</td>
				`;
				tbody.appendChild(row);
			}
		});
	</script>
</body>

</html>
